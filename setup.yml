---
- name: Configure MacBook with Ansible
  hosts: localhost
  gather_facts: false
  become: false
  tasks:
    - name: install brew packages
      become: false
      homebrew:
        name: "{{ item }}"
        state: present
      loop:
        - colima
        - kubernetes-cli
        - kube-ps1
        - helm
        - kubectx
        - argocd
        - zsh-autosuggestions
        - zsh-syntax-highlighting
        - zsh-completions
        - zsh-history-substring-search
        - flux
        - azure-cli
        - mise
        - cloudflared
        - trivy
    - name: install casks
      become: false
      homebrew_cask:
        name: "{{ item }}"
        state: present
      loop:
        - iterm2
        - amethyst
        - discord
        - expressvpn
        - flutter
        - spotify
        - vlc
        - datagrip
        - rider
        - cursor

    - name: Ensure the Homebrew tap is added
      homebrew_tap:
        name: mfuentesg/tap
        state: present

    - name: Install ksd from mfuentesg/tap
      homebrew:
        name: mfuentesg/tap/ksd
        state: present

    - name: sync zshrc
      become: false
      copy:
        content: "{{ lookup('file', 'resources/.zshrc') }}"
        dest: ~/.zshrc
        mode: "0644"

    - name: Ensure colima is configured
      shell: colima start --profile rosetta --cpu 4 --memory 8 --disk 100 --arch aarch64 --vm-type=vz --vz-rosetta --mount-type virtiofs
